
on:
  push:
    branches: ['**']

name: build


jobs:
  build:
    runs-on: macos-11

    env:
      R_VERSION: '4.1.3'
      REPO_SNAPSHOT_DATE: "2023-04-07"
      REPO_URL: "https://packagemanager.rstudio.com/cran/2023-04-07"

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3
    
    - name: Install R
      run: |
        curl -o R.pkg https://cran.r-project.org/bin/macosx/base/R-$R_VERSION.pkg
        sudo installer -pkg R.pkg -target /
    
    - name: Copy and set up R
      run: |
        ditto /Library/Frameworks/R.framework R.framework
        rm -f R.framework/Versions/4.1/Resources/fontconfig/fonts/conf.d/*
        cp /Library/Frameworks/R.framework/Versions/4.1/Resources/fontconfig/fonts/conf.d/* R.framework/Versions/4.1/Resources/fontconfig/fonts/conf.d/
      
    - name: Install base
      run: |
        mkdir -p R.framework/Resources/base
        mkdir -p R.framework/Resources/base/R
        /Library/Frameworks/R.framework/Resources/bin/R -e "install.packages(c('R6', 'RColorBrewer', 'base64enc', 'brio', 'cpp11', 'curl', 'farver', 'fastmap', 'magrittr', 'praise', 'rprojroot', 'rstudioapi', 'utf8', 'viridisLite', 'yaml', 'Rcpp', 'colorspace', 'crayon', 'digest', 'evaluate', 'fansi', 'glue', 'gtable', 'isoband', 'jsonlite', 'labeling', 'pkgconfig', 'ps', 'remotes', 'rlang', 'stringi', 'systemfonts', 'withr', 'xfun', 'RInside', 'RProtoBuf', 'cli', 'desc', 'diffobj', 'ellipsis', 'highr', 'htmltools', 'lifecycle', 'munsell', 'processx', 'stringr', 'textshaping', 'tinytex', 'callr', 'jquerylib', 'knitr', 'pkgload', 'ragg', 'scales', 'vctrs', 'pillar', 'rmarkdown', 'tibble', 'ggplot2', 'rematch2', 'waldo', 'testthat'), repos='$REPO_URL', lib='R.framework/Resources/base/R')"
